<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProductsList</title>
  <link rel="stylesheet" href="../css/userstyles.css">
</head>
<body>
<header>
  <div class="logo">
    <a href="../InitialPage.html">
      <img src="../images/NutriCelia.png" alt="Logo">
    </a>
  </div>
  <div class="titulo">
    <h1>Tus listas</h1>
  </div>
</header>
<main>
<div class="formulario">
  <form id="busqueda_productos">
    <input type="text" name="producto" placeholder="Buscar productos...">
    <button type="submit" class="btn">Buscar</button>
  </form>
</div>
<div class="lista_productos">
  <h2>Lista *nombre*</h2><!--Aqui va el nombre de la vista-->

  <table id="productos-table">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Opciones</th>
      </tr>
    </thead>
    <tbody id="productos-body">
    <tr>
      <td>Producto</td>
      <td>Cantidad</td>
      <td>Opciones</td>
    </tr>
      <!--Esta parte tiene que ser para cada elemento de la base de datos-->

      <!--Mirar de añadir la cantidad a la base de datos-->

      <!--Enlaces para MarcarComprado, Eliminar-->
    </tbody>
  </table>
</div>

<script>
  // Id de la lista que quieres cargar, podrías obtenerla dinámicamente
  const idLista = 1; // Por ejemplo, la lista 1
  const apiBaseUrl = 'http://localhost:8080/productsList'; // Cambia si usas otro host o puerto

  // Cargar productos al cargar la página
  document.addEventListener('DOMContentLoaded', () => {
    cargarProductos();
  });

  // Función para obtener y renderizar la lista de productos
  async function cargarProductos() {
    try {
      const response = await fetch(`${apiBaseUrl}/list/${idLista}`);
      const productos = await response.json();
      renderProductos(productos);
    } catch (error) {
      console.error('Error al cargar productos:', error);
    }
  }

  // Renderizar los productos en la tabla
  function renderProductos(productos) {
    const tbody = document.getElementById('productos-body');
    tbody.innerHTML = ''; // Limpiar antes de renderizar

    productos.forEach(item => {
      const tr = document.createElement('tr');

      // Columna Producto (id_producto)
      const tdProducto = document.createElement('td');
      tdProducto.textContent = `Producto ${item.productsListId.nombre}`; // Aquí podrías cargar más info si la tuvieras

      // Columna Cantidad (no tienes cantidad en el modelo aún)
      const tdCantidad = document.createElement('td');
      tdCantidad.textContent = '1'; // Por ahora es fijo, si quieres agregamos el campo luego

      // Columna Opciones
      const tdOpciones = document.createElement('td');

      // Botón Eliminar
      const btnEliminar = document.createElement('button');
      btnEliminar.textContent = 'Eliminar';
      btnEliminar.onclick = () => eliminarProducto(item.productsListId.id_lista, item.productsListId.id_producto);

      // Botón Marcar como Comprado (puedes definir su lógica)
      const btnMarcar = document.createElement('button');
      btnMarcar.textContent = 'Marcar como Comprado';
      btnMarcar.onclick = () => marcarComoComprado(item.productsListId.id_lista, item.productsListId.id_producto);

      tdOpciones.appendChild(btnEliminar);
      tdOpciones.appendChild(btnMarcar);

      // Agregar columnas a la fila
      tr.appendChild(tdProducto);
      tr.appendChild(tdCantidad);
      tr.appendChild(tdOpciones);

      tbody.appendChild(tr);
    });
  }

  // Función para eliminar un producto
  async function eliminarProducto(id_lista, id_producto) {
    if (!confirm('¿Estás seguro de eliminar este producto?')) return;

    try {
      const response = await fetch(`${apiBaseUrl}/${id_lista}/${id_producto}`, {
        method: 'DELETE'
      });

      if (response.ok) {
        alert('Producto eliminado');
        cargarProductos(); // Recargar productos después de eliminar
      } else {
        alert('Error al eliminar producto');
      }
    } catch (error) {
      console.error('Error al eliminar producto:', error);
    }
  }

  // Función para marcar como comprado (esto depende de cómo manejes el estado en backend)
  function marcarComoComprado(id_lista, id_producto) {
    alert(`Producto ${id_producto} de la lista ${id_lista} marcado como comprado (esto es solo un placeholder)`);

    // Aquí irá la opción de añadir confirmar que se ha comprado y se guardará en el historial

  }

  // Esto será donde se realizará la busqueda
  const formBusqueda = document.getElementById('busqueda_productos');
  formBusqueda.addEventListener('submit', (event) => {
    event.preventDefault();
    const query = formBusqueda.producto.value.toLowerCase();

    const filas = document.querySelectorAll('#productos-body tr');
    filas.forEach(fila => {
      const productoTexto = fila.querySelector('td').textContent.toLowerCase();
      fila.style.display = productoTexto.includes(query) ? '' : 'none';
    });
  });
</script>

</main>
</body>
</html>